# Test the SplitByFiles algorithm using the TestSubmitter

from GangaLHCb.test import *

addLocalTestSubmitter()

ap = DaVinci()
j = Job(application=ap, backend=TestSubmitter(time=1))

j.splitter=SplitByFiles(filesPerJob=1)
#j.inputdata=LHCbDataset(['lfn:/lhcb/data/2010/DIMUON.DST/00008395/0000/00008395_00000326_1.dimuon.dst','lfn:/lhcb/data/2010/DIMUON.DST/00008395/0000/00008395_00000682_1.dimuon.dst']) #updating dataset to stripping 17
j.inputdata=LHCbDataset(['LFN:/lhcb/LHCb/Collision11/DIMUON.DST/00012914/0000/00012914_00000255_1.dimuon.dst',
                         'LFN:/lhcb/LHCb/Collision11/DIMUON.DST/00012961/0000/00012961_00000493_1.dimuon.dst'])
j.submit()

assert(len(j.subjobs)==2)
assert(j.inputdata.files[0].name==j.subjobs[0].inputdata.files[0].name)
assert(j.inputdata.files[-1].name==j.subjobs[1].inputdata.files[-1].name)


j = j.copy()
j.splitter.maxFiles=1
j.submit()
assert(len(j.subjobs)==1)
assert(len(j.subjobs[0].inputdata.files)==1)


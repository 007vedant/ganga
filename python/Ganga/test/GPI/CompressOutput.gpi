from GangaTest.Framework.utils import sleep_until_state

j = Job(application=Executable(exe='/bin/echo',args=['Hello World']))
j.backend = Local()
j.outputfiles = [CompressedFile('stderr')]
j.submit()

# wait for the job to switch to completed

sleep_until_state(j, timeout=120, state='completed')

import os

assert('stdout' in os.listdir(j.outputdir))
assert('stderr.gz' in os.listdir(j.outputdir))



j1 = Job(application=Executable(exe='/bin/echo',args=['Hello World']))
j1.backend = Local()
j1.outputfiles = [CompressedFile('stderr'), CompressedFile('stdout')]
j1.submit()

# wait for the job to switch to completed

sleep_until_state(j1, timeout=120, state='completed')

assert('stdout' not in os.listdir(j1.outputdir))
assert('stderr' not in os.listdir(j1.outputdir))
assert('stderr.gz' in os.listdir(j1.outputdir))
assert('stdout.gz' in os.listdir(j1.outputdir))

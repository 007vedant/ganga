import sys
from Ganga.Utility.Plugin import allPlugins
from Ganga.Utility.logging import getLogger
from Ganga.Utility.Config import getConfig, setConfigOption
from Ganga.Core.GangaRepository import getRegistry

logger = getLogger()

##We have to determine the Ganga version this way because the PRE always thinks config['System']['GANGA_VERSION'] is GANGA-SVN
this_version=getConfig('System')['GANGA_PYTHONPATH'].split('/')[6]
this_repo=getConfig('Configuration')['gangadir']

logger.error('#################### RUNNING JOB GENERATOR')
logger.error('#################### Executing Ganga version: ' + this_version)
logger.error('#################### Creating repo at: ' + this_repo)



totnumobs = 0
#Create an Executable job for each of the available backends
for thing in allPlugins.all_dict:
    for subthing in allPlugins.all_dict[thing]:
        new_name = str(this_version + "_" + thing + "_" + subthing)

        if len(box.select(name=new_name)) == 0:
            a=subthing
            box.add(a, new_name)
            totnumobs += 1
            logger.error("Creating " + str(new_name))
        else:
            logger.error("Already in box: " + str(new_name))

logger.error('total number of objects')
logger.error(totnumobs)

if totnumobs > 0:
    assert totnumobs == len(box), 'We failed to create the correct number of test objects. %i created' % (totnumobs)
else:
    logger.warning("We didn't create any test objects; perhaps they all existed already?")
    logger.warning("There are %i objects in the box repository" % (len(box)))
    






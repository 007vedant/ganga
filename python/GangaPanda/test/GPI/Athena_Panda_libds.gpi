# testing structure for Athena application
# this test-case is CERN AFS dependent since it use setup files located in /afs/cern.ch/sw/ganga/external/test-externals/1.0/noarch/ATLAS 

from GangaTest.Framework.utils import sleep_until_completed,file_contains,write_file,sleep_until_state

config['TestingFramework']['timeout']=3600

import getpass,commands

joboption = '/tmp/ganga_athena_panda_libds_testing_data-%s/AnalysisSkeleton_topOptions.py' % getpass.getuser()

j=Job()
j.application=Athena()
j.application.atlas_run_dir = 'PhysicsAnalysis/AnalysisCommon/UserAnalysis/run'
j.application.atlas_run_config = {'input': {}, 'other': {}, 'output': {'outAANT': [('AANTupleStream', 'AANT')]}}
j.application.atlas_release = '15.6.9'
j.application.option_file = [joboption]
j.inputdata = DQ2Dataset()
j.inputdata.dataset = ['data10_7TeV.00155634.physics_L1Calo.merge.AOD.f260_m496' ]
j.inputdata.number_of_files = 1
j.outputdata = DQ2OutputDataset()
j.outputdata.datasetname='testing.%s'%commands.getoutput('uuidgen')
j.splitter = DQ2JobSplitter()
j.splitter.filesize = 4000
j.splitter.numsubjobs = 1
j.backend = Panda()
j.backend.libds = 'user.dvanders.20100615.666.lib'
assert(j.submit()==True)

# removing all jobs
j.remove()
